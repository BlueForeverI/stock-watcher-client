@page "/stocks"
@inject StocksService stocksService
@inject StateService state

<h3>Stocks</h3>

@if (stocks == null)
{
<div class="spinner-border text-primary"></div>
}
else
{
    <MatTable Items="@stocks" Class="mat-elevation-z5">
        <MatTableHeader>
            <th>Symbol</th>
            <th style="width: 60%">Name</th>
            <th>Action</th>
        </MatTableHeader>
        <MatTableRow>
            <td>@context.Symbol</td>
            <td>@context.Name</td>
            <td>
                <button class="btn btn-outline-primary oi oi-plus font-weight-bold"
                        @onclick="@(() => AddStock(context.ID))"></button>
            </td>
        </MatTableRow>
    </MatTable>
}

@code {
    private List<Stock> stocks;

    protected override async Task OnInitializedAsync()
    {
        this.stocks = await this.stocksService.GetStocks();
    }

    private async void AddStock(int stockId)
    {
        this.stocks = null;
        await this.stocksService.AddStock(stockId, this.state.LoggedUser.ID);
        this.stocks = await this.stocksService.GetStocks();
    }
}
